<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitoring Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 58, 138, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .monitoring-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 25px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.active {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }
        
        .status-dot.inactive {
            background: #ef4444;
            box-shadow: 0 0 10px #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        .card-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-icon {
            font-size: 1.5rem;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-value.good {
            color: #10b981;
        }
        
        .metric-value.warning {
            color: #f59e0b;
        }
        
        .metric-value.danger {
            color: #ef4444;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .progress-fill.warning {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }
        
        .progress-fill.danger {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }
        
        .alerts-container {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .alert-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .alert-item:hover {
            transform: translateX(5px);
        }
        
        .alert-item.info {
            border-color: #3b82f6;
        }
        
        .alert-item.warning {
            border-color: #f59e0b;
        }
        
        .alert-item.error {
            border-color: #ef4444;
        }
        
        .alert-item.critical {
            border-color: #dc2626;
            animation: alertPulse 2s infinite;
        }
        
        @keyframes alertPulse {
            0%, 100% { background: rgba(220, 38, 38, 0.1); }
            50% { background: rgba(220, 38, 38, 0.2); }
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .alert-message {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .alert-time {
            font-size: 0.8rem;
            color: #64748b;
        }
        
        .alert-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .chart-container {
            height: 250px;
            margin-top: 20px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-select {
            padding: 8px 12px;
            background: rgba(30, 58, 138, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #60a5fa;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .mini-metric {
            text-align: center;
            padding: 15px;
            background: rgba(30, 58, 138, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .mini-metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .mini-metric-label {
            font-size: 0.8rem;
            color: #94a3b8;
            text-transform: uppercase;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(30, 58, 138, 0.1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header">
        <h1>📊 System Monitoring Dashboard</h1>
        <div class="monitoring-status">
            <div class="status-indicator">
                <div class="status-dot inactive" id="monitoringStatus"></div>
                <span id="monitoringStatusText">Monitoring Offline</span>
            </div>
            <button class="btn btn-success" id="startBtn" onclick="startMonitoring()">Start Monitoring</button>
            <button class="btn btn-danger" id="stopBtn" onclick="stopMonitoring()" style="display: none;">Stop Monitoring</button>
        </div>
    </div>
    
    <!-- System Metrics -->
    <div class="dashboard-grid">
        <div class="card">
            <div class="card-title">
                <span class="card-icon">💻</span>
                CPU Usage
            </div>
            <div class="metric-value" id="cpuUsage">0%</div>
            <div class="progress-bar">
                <div class="progress-fill" id="cpuProgress" style="width: 0%"></div>
            </div>
            <div class="metric-label">System Processor</div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span class="card-icon">🧠</span>
                Memory Usage
            </div>
            <div class="metric-value" id="memoryUsage">0%</div>
            <div class="progress-bar">
                <div class="progress-fill" id="memoryProgress" style="width: 0%"></div>
            </div>
            <div class="metric-label">RAM Utilization</div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span class="card-icon">💾</span>
                Disk Usage
            </div>
            <div class="metric-value" id="diskUsage">0%</div>
            <div class="progress-bar">
                <div class="progress-fill" id="diskProgress" style="width: 0%"></div>
            </div>
            <div class="metric-label">Storage Space</div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span class="card-icon">🌐</span>
                API Health
            </div>
            <div class="metric-value" id="apiHealth">Good</div>
            <div class="metrics-grid">
                <div class="mini-metric">
                    <div class="mini-metric-value" id="apiRequests">0</div>
                    <div class="mini-metric-label">Requests</div>
                </div>
                <div class="mini-metric">
                    <div class="mini-metric-value" id="apiErrors">0</div>
                    <div class="mini-metric-label">Errors</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span class="card-icon">📈</span>
                Trading Metrics
            </div>
            <div class="metrics-grid">
                <div class="mini-metric">
                    <div class="mini-metric-value" id="activePositions">0</div>
                    <div class="mini-metric-label">Positions</div>
                </div>
                <div class="mini-metric">
                    <div class="mini-metric-value" id="totalPnl">₹0</div>
                    <div class="mini-metric-label">P&L</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span class="card-icon">⚠️</span>
                System Alerts
            </div>
            <div class="metrics-grid">
                <div class="mini-metric">
                    <div class="mini-metric-value" id="activeAlerts">0</div>
                    <div class="mini-metric-label">Active</div>
                </div>
                <div class="mini-metric">
                    <div class="mini-metric-value" id="totalAlerts">0</div>
                    <div class="mini-metric-label">Total</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Performance Charts -->
    <div class="dashboard-grid">
        <div class="card">
            <div class="card-title">
                <span class="card-icon">📊</span>
                System Performance History
            </div>
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">
                <span class="card-icon">⏱️</span>
                API Response Time
            </div>
            <div class="chart-container">
                <canvas id="responseTimeChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Alerts Section -->
    <div class="alerts-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="card-title">
                <span class="card-icon">🚨</span>
                Recent Alerts
            </div>
            <div class="controls">
                <select class="filter-select" id="levelFilter" onchange="filterAlerts()">
                    <option value="">All Levels</option>
                    <option value="info">Info</option>
                    <option value="warning">Warning</option>
                    <option value="error">Error</option>
                    <option value="critical">Critical</option>
                </select>
                <select class="filter-select" id="typeFilter" onchange="filterAlerts()">
                    <option value="">All Types</option>
                    <option value="system">System</option>
                    <option value="trading">Trading</option>
                    <option value="api">API</option>
                    <option value="database">Database</option>
                </select>
                <button class="btn btn-small" onclick="refreshAlerts()">Refresh</button>
            </div>
        </div>
        <div id="alertsList">
            <p style="text-align: center; color: #64748b;">No alerts to display</p>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:8000';
        let isMonitoring = false;
        let refreshInterval = null;
        let performanceChart = null;
        let responseTimeChart = null;
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // Start monitoring
        async function startMonitoring() {
            try {
                const response = await fetch(`${API_BASE}/monitoring/start`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    isMonitoring = true;
                    updateMonitoringStatus(true);
                    showNotification('Monitoring service started');
                    startAutoRefresh();
                } else {
                    throw new Error(data.detail || 'Failed to start monitoring');
                }
            } catch (error) {
                showNotification('Failed to start monitoring: ' + error.message);
            }
        }
        
        // Stop monitoring
        async function stopMonitoring() {
            try {
                const response = await fetch(`${API_BASE}/monitoring/stop`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    isMonitoring = false;
                    updateMonitoringStatus(false);
                    showNotification('Monitoring service stopped');
                    stopAutoRefresh();
                } else {
                    throw new Error(data.detail || 'Failed to stop monitoring');
                }
            } catch (error) {
                showNotification('Failed to stop monitoring: ' + error.message);
            }
        }
        
        // Update monitoring status UI
        function updateMonitoringStatus(active) {
            const statusDot = document.getElementById('monitoringStatus');
            const statusText = document.getElementById('monitoringStatusText');
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (active) {
                statusDot.className = 'status-dot active';
                statusText.textContent = 'Monitoring Active';
                startBtn.style.display = 'none';
                stopBtn.style.display = 'block';
            } else {
                statusDot.className = 'status-dot inactive';
                statusText.textContent = 'Monitoring Offline';
                startBtn.style.display = 'block';
                stopBtn.style.display = 'none';
            }
        }
        
        // Refresh monitoring data
        async function refreshMonitoringData() {
            try {
                const response = await fetch(`${API_BASE}/monitoring/status`);
                const data = await response.json();
                
                // Update monitoring status
                isMonitoring = data.monitoring_active;
                updateMonitoringStatus(isMonitoring);
                
                // Update system metrics
                if (data.system_metrics) {
                    updateSystemMetrics(data.system_metrics);
                }
                
                // Update API metrics
                if (data.api_metrics) {
                    updateApiMetrics(data.api_metrics);
                }
                
                // Update trading metrics
                if (data.trading_metrics) {
                    updateTradingMetrics(data.trading_metrics);
                }
                
                // Update alert counts
                document.getElementById('activeAlerts').textContent = data.active_alerts || 0;
                document.getElementById('totalAlerts').textContent = data.total_alerts || 0;
                
                // Refresh alerts
                await refreshAlerts();
                
                // Update charts
                await updateCharts();
                
            } catch (error) {
                console.error('Error refreshing monitoring data:', error);
            }
        }
        
        // Update system metrics
        function updateSystemMetrics(metrics) {
            // CPU Usage
            const cpuPercent = metrics.cpu_percent || 0;
            document.getElementById('cpuUsage').textContent = `${cpuPercent.toFixed(1)}%`;
            document.getElementById('cpuProgress').style.width = `${cpuPercent}%`;
            updateProgressBarColor('cpuProgress', cpuPercent, 60, 80);
            updateMetricColor('cpuUsage', cpuPercent, 60, 80);
            
            // Memory Usage
            const memoryPercent = metrics.memory_percent || 0;
            document.getElementById('memoryUsage').textContent = `${memoryPercent.toFixed(1)}%`;
            document.getElementById('memoryProgress').style.width = `${memoryPercent}%`;
            updateProgressBarColor('memoryProgress', memoryPercent, 70, 85);
            updateMetricColor('memoryUsage', memoryPercent, 70, 85);
            
            // Disk Usage
            const diskPercent = metrics.disk_percent || 0;
            document.getElementById('diskUsage').textContent = `${diskPercent.toFixed(1)}%`;
            document.getElementById('diskProgress').style.width = `${diskPercent}%`;
            updateProgressBarColor('diskProgress', diskPercent, 80, 90);
            updateMetricColor('diskUsage', diskPercent, 80, 90);
        }
        
        // Update API metrics
        function updateApiMetrics(metrics) {
            document.getElementById('apiRequests').textContent = metrics.total_requests || 0;
            document.getElementById('apiErrors').textContent = metrics.failed_requests || 0;
            
            // Calculate health status
            const errorRate = metrics.total_requests > 0 
                ? (metrics.failed_requests / metrics.total_requests) * 100 
                : 0;
            
            let healthStatus = 'Good';
            let healthClass = 'good';
            
            if (errorRate > 10) {
                healthStatus = 'Poor';
                healthClass = 'danger';
            } else if (errorRate > 5) {
                healthStatus = 'Fair';
                healthClass = 'warning';
            }
            
            const apiHealthElement = document.getElementById('apiHealth');
            apiHealthElement.textContent = healthStatus;
            apiHealthElement.className = `metric-value ${healthClass}`;
        }
        
        // Update trading metrics
        function updateTradingMetrics(metrics) {
            document.getElementById('activePositions').textContent = metrics.active_positions || 0;
            
            const pnl = metrics.total_pnl || 0;
            const pnlElement = document.getElementById('totalPnl');
            pnlElement.textContent = formatCurrency(pnl);
            pnlElement.className = pnl >= 0 ? 'mini-metric-value good' : 'mini-metric-value danger';
        }
        
        // Update progress bar color
        function updateProgressBarColor(elementId, value, warningThreshold, dangerThreshold) {
            const element = document.getElementById(elementId);
            element.className = 'progress-fill';
            
            if (value >= dangerThreshold) {
                element.classList.add('danger');
            } else if (value >= warningThreshold) {
                element.classList.add('warning');
            }
        }
        
        // Update metric color
        function updateMetricColor(elementId, value, warningThreshold, dangerThreshold) {
            const element = document.getElementById(elementId);
            element.className = 'metric-value';
            
            if (value >= dangerThreshold) {
                element.classList.add('danger');
            } else if (value >= warningThreshold) {
                element.classList.add('warning');
            } else {
                element.classList.add('good');
            }
        }
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(amount);
        }
        
        // Refresh alerts
        async function refreshAlerts() {
            try {
                const levelFilter = document.getElementById('levelFilter').value;
                const typeFilter = document.getElementById('typeFilter').value;
                
                let url = `${API_BASE}/monitoring/alerts?limit=20`;
                if (levelFilter) url += `&level=${levelFilter}`;
                if (typeFilter) url += `&metric_type=${typeFilter}`;
                
                const response = await fetch(url);
                const alerts = await response.json();
                
                displayAlerts(alerts);
            } catch (error) {
                console.error('Error fetching alerts:', error);
            }
        }
        
        // Display alerts
        function displayAlerts(alerts) {
            const container = document.getElementById('alertsList');
            
            if (!alerts || alerts.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b;">No alerts to display</p>';
                return;
            }
            
            let html = '';
            alerts.forEach(alert => {
                const timestamp = new Date(alert.timestamp).toLocaleString();
                const levelClass = alert.level || 'info';
                
                html += `
                    <div class="alert-item ${levelClass}">
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-message">${alert.message}</div>
                            <div class="alert-time">${timestamp}</div>
                        </div>
                        <div class="alert-actions">
                            ${!alert.resolved ? `<button class="btn btn-small" onclick="resolveAlert('${alert.alert_id}')">Resolve</button>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Resolve alert
        async function resolveAlert(alertId) {
            try {
                const response = await fetch(`${API_BASE}/monitoring/alerts/${alertId}/resolve`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showNotification('Alert resolved');
                    await refreshAlerts();
                }
            } catch (error) {
                showNotification('Failed to resolve alert');
            }
        }
        
        // Filter alerts
        function filterAlerts() {
            refreshAlerts();
        }
        
        // Update charts
        async function updateCharts() {
            try {
                // Get metrics history
                const response = await fetch(`${API_BASE}/monitoring/metrics/history?minutes=30`);
                const history = await response.json();
                
                if (history && history.length > 0) {
                    updatePerformanceChart(history);
                    updateResponseTimeChart();
                }
            } catch (error) {
                console.error('Error updating charts:', error);
            }
        }
        
        // Update performance chart
        function updatePerformanceChart(history) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            const labels = history.map(h => new Date(h.timestamp).toLocaleTimeString());
            const cpuData = history.map(h => h.cpu_percent);
            const memoryData = history.map(h => h.memory_percent);
            
            if (!performanceChart) {
                performanceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'CPU',
                                data: cpuData,
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Memory',
                                data: memoryData,
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#e0e0e0'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(59, 130, 246, 0.1)'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(59, 130, 246, 0.1)'
                                },
                                ticks: {
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                performanceChart.data.labels = labels;
                performanceChart.data.datasets[0].data = cpuData;
                performanceChart.data.datasets[1].data = memoryData;
                performanceChart.update();
            }
        }
        
        // Update response time chart
        function updateResponseTimeChart() {
            const ctx = document.getElementById('responseTimeChart').getContext('2d');
            
            // Generate sample data for now
            const labels = Array.from({length: 10}, (_, i) => {
                const time = new Date();
                time.setMinutes(time.getMinutes() - (10 - i) * 3);
                return time.toLocaleTimeString();
            });
            
            const data = Array.from({length: 10}, () => Math.random() * 1000 + 200);
            
            if (!responseTimeChart) {
                responseTimeChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Response Time (ms)',
                            data: data,
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: '#3b82f6',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(59, 130, 246, 0.1)'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(59, 130, 246, 0.1)'
                                },
                                ticks: {
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return value + 'ms';
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                responseTimeChart.data.labels = labels;
                responseTimeChart.data.datasets[0].data = data;
                responseTimeChart.update();
            }
        }
        
        // Start auto refresh
        function startAutoRefresh() {
            stopAutoRefresh();
            refreshMonitoringData();
            refreshInterval = setInterval(refreshMonitoringData, 10000); // Refresh every 10 seconds
        }
        
        // Stop auto refresh
        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
        }
        
        // Initialize dashboard
        async function initDashboard() {
            await refreshMonitoringData();
            
            if (isMonitoring) {
                startAutoRefresh();
            }
        }
        
        // Initialize on load
        initDashboard();
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            stopAutoRefresh();
        });
    </script>
</body>
</html>